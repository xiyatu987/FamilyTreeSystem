# 中国族谱管理系统 - 启动指南

## 一、系统环境要求

### 1. 核心依赖
- **PHP**: 8.0 或更高版本
- **Composer**: 2.0 或更高版本
- **MySQL**: 5.7 或更高版本
- **Node.js**: 14.0 或更高版本（可选，用于前端资源编译）

### 2. PHP 扩展要求
- BCMath
- Ctype
- Fileinfo
- JSON
- Mbstring
- OpenSSL
- PDO
- Tokenizer
- XML
- ZIP

## 二、环境安装步骤

### 1. 安装 PHP

#### Windows 系统
1. 访问 PHP 官方下载页面：https://windows.php.net/download/
2. 下载 "VS16 x64 Non Thread Safe" 版本（建议 PHP 8.3）
3. 解压到任意目录，如 `C:\php`
4. 将 `C:\php` 添加到系统环境变量 `PATH` 中
5. 复制 `php.ini-development` 为 `php.ini`
6. 在 `php.ini` 中启用必要的扩展（删除前面的分号）：
   ```ini
   extension=php_bcmath.dll
   extension=php_ctype.dll
   extension=php_fileinfo.dll
   extension=php_json.dll
   extension=php_mbstring.dll
   extension=php_openssl.dll
   extension=php_pdo_mysql.dll
   extension=php_tokenizer.dll
   extension=php_xml.dll
   extension=php_zip.dll
   ```

#### 验证 PHP 安装
```bash
php -v
```

### 2. 安装 Composer

#### Windows 系统
1. 下载安装程序：https://getcomposer.org/Composer-Setup.exe
2. 运行安装程序，选择正确的 PHP 路径
3. 验证安装：

```bash
composer -v
```

### 3. 安装 MySQL

1. 访问 MySQL 官方下载页面：https://dev.mysql.com/downloads/mysql/
2. 下载并安装 MySQL 8.0
3. 记住设置的 root 密码
4. 确保 MySQL 服务已启动

## 三、项目启动步骤

### 1. 安装 PHP 依赖

打开命令行，进入项目目录：

```bash
cd c:\Users\54143\Downloads\webtrees-2.2.4\族谱管理系统
```

安装依赖：

```bash
composer install
```

### 2. 配置数据库

确保 `.env` 文件中的数据库配置正确：

```env
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=genealogy_system
DB_USERNAME=root
DB_PASSWORD=your_password
```

创建数据库：

```bash
mysql -u root -p
CREATE DATABASE genealogy_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
EXIT;
```

### 3. 运行数据库迁移

```bash
php artisan migrate
```

（可选）填充测试数据：

```bash
php artisan db:seed
```

### 4. 生成应用密钥

```bash
php artisan key:generate
```

### 5. 启动开发服务器

```bash
php artisan serve
```

### 6. 访问系统

打开浏览器，访问：http://localhost:8000

## 四、常见问题解决

### 1. PHP 扩展缺失

**错误信息**：
```
PHP Warning:  PHP Startup: Unable to load dynamic library 'php_XXXX.dll'
```

**解决方案**：
- 确认 `php.ini` 中已启用对应的扩展
- 确认 PHP 版本与扩展版本匹配

### 2. 数据库连接失败

**错误信息**：
```
SQLSTATE[HY000] [1045] Access denied for user 'root'@'localhost' (using password: YES)
```

**解决方案**：
- 检查 `.env` 文件中的数据库配置
- 确认 MySQL 服务已启动
- 确认用户权限正确

### 3. Composer 依赖安装失败

**错误信息**：
```
curl error 60 while downloading https://repo.packagist.org/p2/laravel/ui.json: SSL certificate problem: self-signed certificate in certificate chain
```

**解决方案**：
- 临时禁用 SSL 验证：
  ```bash
  composer config --global disable-tls true
  composer config --global secure-http false
  ```

### 4. 端口被占用

**错误信息**：
```
Address already in use
```

**解决方案**：
- 使用其他端口启动：
  ```bash
  php artisan serve --port=8080
  ```

## 五、项目结构说明

```
├── app/              # 应用代码
│   ├── Http/         # 控制器、中间件
│   ├── Models/       # 数据模型
│   ├── Policies/     # 权限策略
│   └── Services/     # 业务服务
├── bootstrap/        # 框架引导
├── database/         # 数据库迁移、填充
├── public/           # 静态资源、入口文件
├── resources/        # 视图、语言文件
├── routes/           # 路由定义
├── storage/          # 存储目录
└── vendor/           # 依赖包
```

## 六、功能模块

- **用户管理**：注册、登录、权限控制
- **家族成员管理**：成员信息、家族关系
- **字辈管理**：字辈设置、生成管理
- **宗族结构**：宗族树、分支管理
- **祠堂管理**：祠堂信息、历史记录
- **迁徙记录**：家族迁徙轨迹
- **墓地信息**：墓地位置、历史
- **家族规则**：家族规范、传统

## 七、联系方式

如有任何问题，请联系系统管理员。

---

**中国族谱管理系统**
**版本：1.0.0**