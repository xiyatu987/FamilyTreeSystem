# 字辈管理功能设计

## 1. 功能概述

字辈管理是中国族谱的核心特色功能，用于管理宗族成员的字辈排行，自动分配字辈，并提供字辈谱系图展示。

## 2. 数据模型设计

### 2.1 自定义GEDCOM标签

- **`_ZIWEI`**：存储人员的字辈信息
  - 属性：
    - `VALUE`：字辈文本
    - `GENERATION`：所属世代
    - `ORDER`：在世代中的排行

### 2.2 数据库扩展

- 在`individuals`表中添加`ziwei`字段
- 创建`ziwei_library`表，用于存储字辈库
  - `z_id`：主键
  - `z_tree_id`：所属家谱树
  - `z_name`：字辈库名称
  - `z_desc`：字辈库描述
  - `z_ziweis`：字辈列表（JSON格式）
  - `z_default`：是否为默认字辈库

## 3. 核心功能实现

### 3.1 字辈库管理

- 支持创建、编辑、删除字辈库
- 支持导入/导出字辈库
- 支持设置默认字辈库

### 3.2 字辈分配

- 自动为新生成员分配字辈
- 支持手动修改字辈
- 支持批量分配字辈

### 3.3 字辈展示

- 在人员详情页显示字辈
- 支持字辈谱系图展示
- 支持字辈查询功能

## 4. 代码实现计划

### 4.1 扩展Individual类

- 添加`getZiwei()`方法，获取人员字辈
- 添加`setZiwei()`方法，设置人员字辈
- 添加`getGeneration()`方法，获取人员世代

### 4.2 创建ZiweiService类

- 实现字辈库管理功能
- 实现字辈自动分配逻辑
- 实现字辈谱系图生成

### 4.3 添加界面组件

- 字辈库管理界面
- 人员编辑时的字辈选择组件
- 字辈谱系图展示组件

### 4.4 扩展语言文件

- 添加字辈相关的中文翻译

## 5. 实现步骤

1. 创建自定义GEDCOM标签定义
2. 扩展Individual类，添加字辈相关方法
3. 创建ZiweiService类，实现核心逻辑
4. 添加字辈库管理界面
5. 添加人员编辑时的字辈选择功能
6. 实现字辈谱系图展示
7. 测试功能完整性

## 6. 与现有功能集成

- 与人员管理功能集成
- 与家谱树功能集成
- 与隐私控制功能集成

## 7. 性能优化考虑

- 字辈信息缓存
- 谱系图生成优化
- 批量操作优化