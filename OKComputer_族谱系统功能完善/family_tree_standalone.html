<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>家族族谱系统 - 独立版本</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
        }
        .container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        header {
            background-color: #2c3e50;
            color: white;
            padding: 1rem;
            text-align: center;
        }
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 1rem;
        }
        #familyTree {
            width: 100%;
            height: 100%;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .controls {
            margin-bottom: 1rem;
            display: flex;
            gap: 1rem;
        }
        button {
            padding: 0.5rem 1rem;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .instructions {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #e8f4f8;
            border-radius: 4px;
        }
        .instructions h3 {
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }
        .instructions p {
            color: #666;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>家族族谱系统</h1>
        </header>
        <div class="main-content">
            <div class="controls">
                <button onclick="expandAll()">展开所有</button>
                <button onclick="collapseAll()">折叠所有</button>
            </div>
            <div id="familyTree"></div>
            <div class="instructions">
                <h3>使用说明</h3>
                <p>1. 本页面是家族族谱系统的独立版本，无需服务器，可直接在浏览器中打开</p>
                <p>2. 鼠标悬停在节点上可查看详细信息</p>
                <p>3. 点击节点可展开/折叠子节点</p>
                <p>4. 使用控制按钮可快速展开或折叠所有节点</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <script>
        // 确保ECharts加载完成后再初始化
        if (typeof echarts === 'undefined') {
            // 如果CDN加载失败，显示错误信息
            document.getElementById('familyTree').innerHTML = '<div style="padding: 20px; text-align: center; color: #e74c3c;">ECharts库加载失败，请检查网络连接或稍后重试。</div>';
        } else {
        // 初始化ECharts实例
        var myChart = echarts.init(document.getElementById('familyTree'));
        
        // 家族树数据
        var treeData = {
            name: '家族树',
            member: { id: 1, name: '王万', gender: 'male', birth: '1900-01-01', death: '1980-12-31' },
            children: [
                {
                    name: '李万',
                    member: { id: 2, name: '李万', gender: 'male', birth: '1920-01-01', death: '2000-12-31' },
                    spouse: { name: '张万', gender: 'female' },
                    children: [
                        {
                            name: '王一一',
                            member: { id: 3, name: '王一一', gender: 'male', birth: '1940-01-01', death: '2020-12-31' },
                            spouse: { name: '李一一', gender: 'female' }
                        },
                        {
                            name: '王一二',
                            member: { id: 4, name: '王一二', gender: 'female', birth: '1942-01-01' },
                            spouse: { name: '李一二', gender: 'male' }
                        }
                    ]
                },
                {
                    name: '王五',
                    member: { id: 5, name: '王五', gender: 'male', birth: '1925-01-01', death: '2005-12-31' },
                    spouse: { name: '赵五', gender: 'female' },
                    children: [
                        {
                            name: '王二一',
                            member: { id: 6, name: '王二一', gender: 'male', birth: '1950-01-01' },
                            spouse: { name: '李二一', gender: 'female' }
                        },
                        {
                            name: '王二二',
                            member: { id: 7, name: '王二二', gender: 'female', birth: '1952-01-01' },
                            spouse: { name: '李二二', gender: 'male' }
                        },
                        {
                            name: '王二三',
                            member: { id: 8, name: '王二三', gender: 'male', birth: '1955-01-01' },
                            spouse: { name: '李二三', gender: 'female' }
                        }
                    ]
                }
            ]
        };

        // ECharts配置
        var option = {
            tooltip: {
                trigger: 'item',
                triggerOn: 'mousemove',
                formatter: function(params) {
                    if (!params.data.member) return params.name;
                    
                    const member = params.data.member;
                    let content = `<div class="tooltip-container">`;
                    content += `<h4>${member.name} (${member.gender === 'male' ? '男' : '女'})</h4>`;
                    content += `<p>出生: ${member.birth || '未知'}</p>`;
                    if (member.death) {
                        content += `<p>去世: ${member.death}</p>`;
                    }
                    
                    // 如果有配偶，显示配偶信息
                    if (params.data.spouse) {
                        const spouse = params.data.spouse;
                        content += `<h4>配偶: ${spouse.name} (${spouse.gender === 'male' ? '男' : '女'})</h4>`;
                    }
                    
                    content += `</div>`;
                    return content;
                }
            },
            series: [
                {
                    type: 'tree',
                    data: [treeData],
                    top: '3%',
                    left: '15%',
                    bottom: '3%',
                    right: '3%',
                    symbolSize: function(params) {
                        return params && params.data && params.data.spouse ? 160 : 80;
                    },
                    symbol: 'none',
                    symbolRotate: 0,
                    symbolOffset: [0, 0],
                    symbolKeepAspect: true,
                    layout: 'orthogonal',
                    orient: 'TB',
                    levelGap: 80,
                    nodeGap: 20,
                    leaves: {
                        orient: 'LR'
                    },
                    label: {
                        position: 'inside',
                        verticalAlign: 'middle',
                        align: 'center',
                        fontSize: 12,
                        color: '#333',
                        formatter: function(params) {
                            const data = params.data;
                            if (!data.member) return params.name;
                            
                            // 如果有配偶，显示夫妻信息
                            if (data.spouse) {
                                return '{spouseContainer|{maleSection|{maleName|' + data.member.name + '}}{femaleSection|{femaleName|' + data.spouse.name + '}}}';
                            }
                            
                            // 单个成员
                            if (data.member.gender === 'male') {
                                return '{singleContainer|{maleName|' + data.member.name + '}}';
                            } else {
                                return '{singleContainer|{femaleName|' + data.member.name + '}}';
                            }
                        },
                        rich: {
                            spouseContainer: {
                                width: 120,
                                height: 60,
                                backgroundColor: '#f0f0f0',
                                border: '1px solid #ccc',
                                borderRadius: 5,
                                padding: 5,
                                align: 'center',
                                verticalAlign: 'middle'
                            },
                            singleContainer: {
                                width: 80,
                                height: 60,
                                backgroundColor: '#f0f0f0',
                                border: '1px solid #ccc',
                                borderRadius: 5,
                                padding: 5,
                                align: 'center',
                                verticalAlign: 'middle'
                            },
                            maleSection: {
                                align: 'center',
                                paddingRight: 5
                            },
                            femaleSection: {
                                align: 'center',
                                paddingLeft: 5
                            },
                            maleName: {
                                color: '#1f77b4'
                            },
                            femaleName: {
                                color: '#e74c3c'
                            }
                        }
                    },
                    lineStyle: {
                        color: '#8b4513',
                        width: 2,
                        curveness: 0.2
                    },
                    initialTreeDepth: -1,
                    expandAndCollapse: true
                }
            ]
        };

        // 设置配置项
        myChart.setOption(option);

        // 响应式处理
        window.addEventListener('resize', function() {
            myChart.resize();
        });

        // 展开所有节点
        function expandAll() {
            myChart.dispatchAction({
                type: 'expandTree',
                seriesIndex: 0,
                dataIndex: [0]
            });
        }

        // 折叠所有节点
        function collapseAll() {
            myChart.dispatchAction({
                type: 'collapseTree',
                seriesIndex: 0,
                dataIndex: [0]
            });
        }
        // 关闭条件语句
        }
    </script>
</body>
</html>